# ANC Platform - Package Distribution Guide

This document explains how to install and use the various package distributions of the ANC Platform.

## üì¶ Available Packages

### 1. Docker Container (ghcr.io)

The official Docker container is the recommended way to deploy the ANC Platform in production.

**Registry**: GitHub Container Registry (ghcr.io)
**Image**: `ghcr.io/surya893/anc-with-ai`

#### Quick Start

```bash
# Pull latest version
docker pull ghcr.io/surya893/anc-with-ai:latest

# Pull specific version
docker pull ghcr.io/surya893/anc-with-ai:1.0.0

# Run container
docker run -d \
  -p 5000:5000 \
  -e DATABASE_URL=postgresql://user:pass@localhost:5432/anc \
  -e REDIS_URL=redis://localhost:6379/0 \
  -e SECRET_KEY=your-secret-key \
  --name anc-platform \
  ghcr.io/surya893/anc-with-ai:1.0.0

# Check logs
docker logs -f anc-platform

# Access the platform
curl http://localhost:5000/health
```

#### Available Tags

- `latest` - Latest stable release
- `1.0.0` - Specific version
- `1.0` - Minor version
- `1` - Major version
- `main-<sha>` - Development builds from main branch

#### Environment Variables

```bash
# Required
DATABASE_URL=postgresql://user:pass@host:port/db
REDIS_URL=redis://host:port/db
SECRET_KEY=your-secret-key

# Optional
FLASK_ENV=production
ANC_FILTER_TAPS=512
ANC_SAMPLE_RATE=48000
ML_CONFIDENCE_THRESHOLD=0.7
EMERGENCY_DETECTION_ENABLED=true
```

#### Docker Compose

```yaml
version: '3.8'

services:
  anc-platform:
    image: ghcr.io/surya893/anc-with-ai:1.0.0
    ports:
      - "5000:5000"
    environment:
      DATABASE_URL: postgresql://anc:password@postgres:5432/anc_db
      REDIS_URL: redis://redis:6379/0
      SECRET_KEY: ${SECRET_KEY}
    depends_on:
      - postgres
      - redis
    restart: unless-stopped

  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: anc_db
      POSTGRES_USER: anc
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### 2. Python Package (PyPI)

Install the ANC Platform as a Python library.

**Package Name**: `anc-platform`
**Version**: 1.0.0

#### Installation

```bash
# Basic installation
pip install anc-platform==1.0.0

# With cloud extras (AWS support)
pip install anc-platform[cloud]==1.0.0

# With development tools
pip install anc-platform[dev]==1.0.0

# From source
git clone https://github.com/Surya893/anc-with-ai.git
cd anc-with-ai
pip install -e .
```

#### Usage as Library

```python
from anc_platform.core.audio_processor import AudioProcessor
from anc_platform.ml.emergency_noise_detector import EmergencyNoiseDetector
import numpy as np

# Initialize audio processor
processor = AudioProcessor(sample_rate=44100)

# Create session
session = processor.create_session('user_123')

# Process audio
audio_data = np.random.randn(10000)  # Your audio data
result = await processor.process_audio_chunk(
    session_id='user_123',
    audio_data=audio_data,
    apply_anc=True
)

print(f"ANC applied: {result['anc_applied']}")
print(f"Noise type: {result['noise_detection']['predicted_class']}")

# Emergency detection
detector = EmergencyNoiseDetector(
    model_path='models/noise_classifier_sklearn.pkl',
    confidence_threshold=0.70
)

should_apply_anc, detection_result = detector.process_audio(audio_data)
if detection_result['is_emergency']:
    print(f"‚ö†Ô∏è Emergency detected: {detection_result['predicted_class']}")
```

#### Command-Line Interface

```bash
# Start the server
anc-server --host 0.0.0.0 --port 5000

# Start the web interface
anc-web --port 8080

# Or use the module directly
python -m anc_platform.server --host 0.0.0.0 --port 5000
```

### 3. Pre-built Release Assets

Download pre-compiled binaries and source archives from the [GitHub Releases page](https://github.com/Surya893/anc-with-ai/releases).

#### Available Assets

**Source Code**:
- `anc-platform-1.0.0-source.tar.gz` - Complete source code
- Source code (zip) - Auto-generated by GitHub

**Python Packages**:
- `anc_platform-1.0.0-py3-none-any.whl` - Python wheel (universal)
- `anc-platform-1.0.0.tar.gz` - Python source distribution

**Firmware** (if applicable):
- `anc-platform-1.0.0-firmware.tar.gz` - Pre-compiled firmware binaries

#### Installation from Release Assets

```bash
# Download and install Python wheel
wget https://github.com/Surya893/anc-with-ai/releases/download/v1.0.0/anc_platform-1.0.0-py3-none-any.whl
pip install anc_platform-1.0.0-py3-none-any.whl

# Download source code
wget https://github.com/Surya893/anc-with-ai/archive/refs/tags/v1.0.0.tar.gz
tar -xzf v1.0.0.tar.gz
cd anc-with-ai-1.0.0/
pip install -r requirements.txt
./start.sh
```

## üîÑ Automated Publishing

Packages are automatically built and published when a new release is created on GitHub.

### GitHub Actions Workflow

The `.github/workflows/publish-release.yml` workflow:
1. Builds Docker images for multiple platforms (amd64, arm64)
2. Publishes to GitHub Container Registry
3. Builds Python packages (wheel and sdist)
4. Creates release assets (source archives, firmware)
5. Attaches assets to the GitHub release

### Manual Publishing

#### Docker Image

```bash
# Build locally
docker build -t ghcr.io/surya893/anc-with-ai:1.0.0 .

# Login to GitHub Container Registry
echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin

# Push
docker push ghcr.io/surya893/anc-with-ai:1.0.0
```

#### Python Package

```bash
# Build package
python -m build

# Upload to PyPI (requires token)
twine upload dist/*

# Or upload to GitHub Packages
twine upload --repository-url https://upload.pypi.org/legacy/ dist/*
```

## üîí Security & Authentication

### Docker Container Registry

To pull from GitHub Container Registry (public packages don't require authentication):

```bash
# For private packages, authenticate first
echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin
docker pull ghcr.io/surya893/anc-with-ai:1.0.0
```

### PyPI / GitHub Packages

```bash
# No authentication required for public packages
pip install anc-platform==1.0.0
```

## üìä Package Sizes

| Package | Size | Description |
|---------|------|-------------|
| Docker Image (compressed) | ~500 MB | Full platform with all dependencies |
| Python Wheel | ~50 KB | Core library only |
| Source Archive | ~5 MB | Complete source code |
| Firmware Binary | ~200 KB | ARM Cortex-M7 firmware |

## üÜò Troubleshooting

### Docker Issues

**Container won't start**:
```bash
# Check logs
docker logs anc-platform

# Verify environment variables
docker inspect anc-platform | grep -A 20 Env

# Run interactively for debugging
docker run -it --rm ghcr.io/surya893/anc-with-ai:1.0.0 /bin/bash
```

**Permission denied**:
```bash
# Make sure you're logged in
echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin
```

### Python Package Issues

**Import errors**:
```bash
# Reinstall with dependencies
pip install --force-reinstall anc-platform==1.0.0

# Check installation
pip show anc-platform
python -c "import anc_platform; print(anc_platform.__version__)"
```

**Missing dependencies**:
```bash
# Install system dependencies (Ubuntu/Debian)
sudo apt-get install portaudio19-dev libsndfile1-dev

# macOS
brew install portaudio libsndfile
```

## üìö Additional Resources

- [GitHub Repository](https://github.com/Surya893/anc-with-ai)
- [Documentation](https://github.com/Surya893/anc-with-ai#readme)
- [Release Notes](https://github.com/Surya893/anc-with-ai/blob/main/RELEASE_NOTES_v1.0.0.md)
- [CHANGELOG](https://github.com/Surya893/anc-with-ai/blob/main/CHANGELOG.md)
- [Issues](https://github.com/Surya893/anc-with-ai/issues)

## üìû Support

For issues or questions:
- GitHub Issues: https://github.com/Surya893/anc-with-ai/issues
- Email: support@anc-platform.com

---

**Version**: 1.0.0 | **Last Updated**: November 17, 2024
